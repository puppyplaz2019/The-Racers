<!DOCTYPE html>
<html>
<head>
    <title>Estate V67 - Gold Treasure Hunt</title>
    <style>
        body { margin: 0; overflow: hidden; background: #000; font-family: 'Courier New', monospace; }
        #ui { position: absolute; top: 10px; left: 10px; color: #fff; background: rgba(0,0,0,0.9); padding: 15px; border: 1px solid #FFD700; pointer-events: none; }
        #gate { position: absolute; top: 10px; right: 10px; pointer-events: auto; }
        #overlay { position: absolute; width: 100%; height: 100%; background: #000; color: #FFD700; display: flex; flex-direction: column; align-items: center; justify-content: center; z-index: 100; }
        .btn { padding: 15px 40px; font-size: 20px; cursor: pointer; background: #FFD700; border: none; color: #000; font-weight: bold; }
        .gate-btn { padding: 10px 20px; background: #FFD700; border: none; font-weight: bold; cursor: pointer; }
        #msg { position: absolute; top: 50%; width: 100%; text-align: center; color: #FFD700; font-size: 30px; font-weight: bold; opacity: 0; pointer-events: none; text-shadow: 0 0 15px #FFD700; }
        #credit { position: absolute; bottom: 10px; left: 10px; color: #555; font-size: 10px; }
    </style>
</head>
<body>

    <div id="overlay">
        <h1>ESTATE V67: TREASURE HUNT</h1>
        <p>FIND THE GOLD | VALIDATE RECEIPT</p>
        <button class="btn" onclick="start()">INITIALIZE</button>
    </div>

    <div id="ui">
        <b>W/S/A/D</b>: Move & Turn<br>
        <b>SPACE</b>: Jump | <b>E</b>: Drive<br>
        <b>B</b>: Build | <b>M</b>: Radio<br>
        <hr>
        PAINT: <span id="status" style="color:#ff4444">STANDARD</span>
    </div>

    <div id="gate">
        <button class="gate-btn" onclick="unlockGold()">ðŸ”‘ VALIDATE RECEIPT</button>
    </div>

    <div id="msg">BULLION STATUS: ACTIVE</div>
    <div id="credit">Powered by Google Gemini | Logic: Priority Input V67</div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script>
        let scene, camera, renderer, car, carBody, shineLight;
        let objects = [], buildableSurface = [], keyStack = [];
        let playerYaw = 0, playerPitch = 0, vy = 0, isJumping = false, isDriving = false;

        function start() { document.getElementById('overlay').style.display = 'none'; init(); }

        function init() {
            scene = new THREE.Scene();
            scene.background = new THREE.Color(0x87CEEB);

            camera = new THREE.PerspectiveCamera(75, window.innerWidth/window.innerHeight, 0.1, 1000);
            camera.position.set(0, 5, 15);

            renderer = new THREE.WebGLRenderer({ antialias: true });
            renderer.setSize(window.innerWidth, window.innerHeight);
            renderer.outputEncoding = THREE.sRGBEncoding;
            document.body.appendChild(renderer.domElement);

            // WORLD LIGHTING
            scene.add(new THREE.AmbientLight(0xffffff, 0.5));
            let sun = new THREE.DirectionalLight(0xffffff, 1.0);
            sun.position.set(10, 50, 10);
            scene.add(sun);

            // CAR SHINE LIGHT (Follows the car to keep it shiny)
            shineLight = new THREE.PointLight(0xffffff, 2, 20);
            scene.add(shineLight);

            // FLOOR
            const floor = new THREE.Mesh(new THREE.PlaneGeometry(1000, 1000), new THREE.MeshStandardMaterial({color: 0x27ae60}));
            floor.rotation.x = -Math.PI/2; 
            scene.add(floor); 
            buildableSurface.push(floor);

            createVillage();
            createCar();

            window.addEventListener('keydown', e => {
                if (!keyStack.includes(e.code)) keyStack.push(e.code);
                if (e.code === 'KeyE') isDriving = !isDriving;
                if (e.code === 'Space' && !isJumping) { vy = 0.5; isJumping = true; }
                if (e.code === 'KeyB') placeBlock();
            });
            window.addEventListener('keyup', e => keyStack = keyStack.filter(k => k !== e.code));

            loop();
        }

        function createCar() {
            car = new THREE.Group();
            carBody = new THREE.Mesh(
                new THREE.BoxGeometry(4, 2, 7), 
                new THREE.MeshStandardMaterial({color: 0xaa0000, metalness: 0.2, roughness: 0.8})
            );
            carBody.position.y = 1; car.add(carBody);
            car.position.set(15, 0, 15);
            scene.add(car);
            objects.push(carBody);
        }

        function createVillage() {
            for(let i=0; i<5; i++) {
                const h = new THREE.Mesh(new THREE.BoxGeometry(10, 10, 10), new THREE.MeshStandardMaterial({color: 0x555555}));
                h.position.set(-30, 5, i * -25);
                scene.add(h);
                objects.push(h);
            }
        }

        function unlockGold() {
            let code = prompt("Enter 16-Digit Receipt Code:");
            if (code === "DEV-MWUNR0XT6-100") {
                carBody.material.color.setHex(0xFFD700);
                carBody.material.metalness = 1.0;
                carBody.material.roughness = 0.02; // Pure Shine
                carBody.material.emissive.setHex(0x332200);
                
                document.getElementById('status').innerText = "GOLD BULLION";
                document.getElementById('status').style.color = "#FFD700";
                document.getElementById('msg').style.opacity = 1;
                setTimeout(() => { document.getElementById('msg').style.opacity = 0; }, 3000);
            } else {
                alert("INVALID RECEIPT. ACCESS DENIED.");
            }
        }

        function placeBlock() {
            const b = new THREE.Mesh(new THREE.BoxGeometry(3,3,3), new THREE.MeshStandardMaterial({color: 0xffffff}));
            b.position.copy(camera.position).add(new THREE.Vector3(0, -2, -5).applyQuaternion(camera.quaternion));
            scene.add(b);
            objects.push(b);
        }

        function loop() {
            requestAnimationFrame(loop);
            const topKey = keyStack[keyStack.length - 1];

            const speed = 0.5;
            const dir = new THREE.Vector3();
            camera.getWorldDirection(dir);
            dir.y = 0; dir.normalize();

            if (topKey === 'KeyW') {
                if(isDriving) car.position.add(dir.clone().multiplyScalar(speed * 2));
                else camera.position.add(dir.clone().multiplyScalar(speed));
            } 
            else if (topKey === 'KeyS') {
                if(isDriving) car.position.sub(dir.clone().multiplyScalar(speed * 2));
                else camera.position.sub(dir.clone().multiplyScalar(speed));
            } 
            else if (topKey === 'KeyA') playerYaw += 0.04;
            else if (topKey === 'KeyD') playerYaw -= 0.04;
            else if (topKey === 'ArrowUp') playerPitch = Math.min(playerPitch + 0.04, 1.5);
            else if (topKey === 'ArrowDown') playerPitch = Math.max(playerPitch - 0.04, -1.5);

            // Shine Light follows car
            shineLight.position.set(car.position.x, car.position.y + 5, car.position.z);

            if(!isDriving) {
                camera.position.y += vy;
                if(isJumping) vy -= 0.025;
                if(camera.position.y <= 5) { camera.position.y = 5; vy = 0; isJumping = false; }
            }

            if(isDriving) {
                car.rotation.y = playerYaw - Math.PI;
                camera.position.set(car.position.x - Math.sin(playerYaw)*12, car.position.y + 6, car.position.z - Math.cos(playerYaw)*12);
                camera.lookAt(car.position);
            } else {
                camera.rotation.order = 'YXZ';
                camera.rotation.y = playerYaw;
                camera.rotation.x = playerPitch;
            }
            renderer.render(scene, camera);
        }
    </script>
</body>
</html>
