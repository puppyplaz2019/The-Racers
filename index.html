<!DOCTYPE html>
<html>
<head>
    <title>Estate V75 - Neon Circuit</title>
    <style>
        body { margin: 0; overflow: hidden; background: #000; font-family: 'Courier New', monospace; color: #fff; }
        #ui { position: absolute; top: 10px; left: 10px; background: rgba(0,0,0,0.8); padding: 15px; border-radius: 8px; border: 1px solid #a020f0; pointer-events: none; }
        
        #cheatBox { position: absolute; top: 10px; right: 10px; background: #111; padding: 15px; border: 2px solid #32cd32; border-radius: 10px; }
        #commentBox { position: absolute; bottom: 20px; left: 20px; background: rgba(10,10,10,0.9); padding: 15px; border: 1px solid #555; width: 250px; border-radius: 5px; }
        #commentList { height: 100px; overflow-y: auto; font-size: 12px; margin-bottom: 5px; border-bottom: 1px solid #333; }
        
        #qrBox { position: absolute; bottom: 20px; right: 350px; background: #fff; padding: 5px; border-radius: 5px; }
        #djDeck { position: absolute; bottom: 20px; right: 20px; background: #111; padding: 15px; border: 2px solid #a020f0; width: 280px; }
        
        input { background: #000; color: #32cd32; border: 1px solid #333; padding: 5px; width: 80%; }
        .btn { cursor: pointer; background: #32cd32; color: #000; border: none; padding: 5px 10px; font-weight: bold; }
        #overlay { position: absolute; width: 100%; height: 100%; background: #000; display: flex; flex-direction: column; align-items: center; justify-content: center; z-index: 100; }
    </style>
</head>
<body>

    <div id="overlay">
        <h1 style="color:#a020f0; letter-spacing:10px;">NEON CIRCUIT V75</h1>
        <button class="btn" style="font-size:20px; padding:15px 40px;" onclick="start()">IGNITION</button>
    </div>

    <div id="ui">
        <b>WASD</b>: Drive | <b>Cheat</b>: race2win<br>
        <b>Status</b>: <span id="carStatus" style="color:#B9F2FF">DIAMOND SHINE</span>
    </div>

    <div id="cheatBox">
        <b>‚å®Ô∏è CHEAT CONSOLE</b><br>
        <input type="text" id="cheatInput" placeholder="Enter Code...">
        <button class="btn" onclick="checkCheat()">ACTIVATE</button>
        <button id="stealthBtn" class="btn" style="display:none; margin-top:5px; width:100%; background:#444;" onclick="toggleStealth()">GHOST MODE: OFF</button>
    </div>

    <div id="commentBox">
        <b>üí¨ PUBLIC COMMENTS</b>
        <div id="commentList">Welcome to the track!</div>
        <input type="text" id="comInput" placeholder="Say something...">
        <button class="btn" onclick="addComment()">SEND</button>
    </div>

    <div id="qrBox">
        <div id="qrcode"></div>
        <div style="color:#000; font-size:8px; text-align:center;">SCAN FOR TRACK</div>
    </div>

    <div id="djDeck">
        <b>üéµ DJ DECK</b><br>
        <input type="text" id="musicLink" placeholder="YouTube URL...">
        <button class="btn" onclick="playLink()">PLAY</button>
        <iframe id="playerFrame" style="display:none; width:100%; height:60px; margin-top:10px;" allow="autoplay"></iframe>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    
    <script>
        let scene, camera, renderer, carGroup, chassis, cabin, spoiler;
        let keyStack = [], playerYaw = 0, speed = 0, isStealth = false;

        function start() {
            document.getElementById('overlay').style.display = 'none';
            init();
            new QRCode(document.getElementById("qrcode"), { text: window.location.href, width: 64, height: 64 });
        }

        function init() {
            scene = new THREE.Scene();
            
            camera = new THREE.PerspectiveCamera(75, window.innerWidth/window.innerHeight, 0.1, 1000);
            
            renderer = new THREE.WebGLRenderer({ antialias: true });
            renderer.setSize(window.innerWidth, window.innerHeight);
            document.body.appendChild(renderer.domElement);

            // CUSTOM NEON GRIDS
            const gridFine = new THREE.GridHelper(1000, 100, 0x32cd32, 0x32cd32); // Green Thin
            scene.add(gridFine);
            const gridCoarse = new THREE.GridHelper(1000, 20, 0xa020f0, 0xa020f0); // Purple Thick
            gridCoarse.position.y = 0.05;
            scene.add(gridCoarse);

            scene.add(new THREE.AmbientLight(0xffffff, 0.4));
            const sun = new THREE.PointLight(0xffffff, 1);
            sun.position.set(0, 50, 0);
            scene.add(sun);

            createTrackAndAudience();
            createCar();

            window.addEventListener('keydown', e => { if(!keyStack.includes(e.code)) keyStack.push(e.code); });
            window.addEventListener('keyup', e => keyStack = keyStack.filter(k => k !== e.code));

            animate();
        }

        function createTrackAndAudience() {
            // Track markers (Blue neon pillars)
            const trackPoints = [
                [50, 0, 50], [150, 0, 50], [200, 0, 150], [150, 0, 250], [50, 0, 250], [-50, 0, 150]
            ];
            
            trackPoints.forEach(p => {
                const pole = new THREE.Mesh(new THREE.CylinderGeometry(1, 1, 20), new THREE.MeshBasicMaterial({color: 0x00ffff}));
                pole.position.set(p[0], 10, p[2]);
                scene.add(pole);

                // Audience members on corners
                for(let j=0; j<5; j++) {
                    const fan = new THREE.Mesh(new THREE.BoxGeometry(2,4,2), new THREE.MeshStandardMaterial({color: Math.random() * 0xffffff}));
                    fan.position.set(p[0] + 10 + j*3, 2, p[2] + 5);
                    scene.add(fan);
                }
            });
            
            // "race2win!" Signage simulated via floating cubes
            console.log("Track UI Loaded: Labels placed at turns.");
        }

        function createCar() {
            carGroup = new THREE.Group();
            const diamondMat = new THREE.MeshStandardMaterial({color: 0xB9F2FF, metalness: 1, roughness: 0.1, transparent: true});
            
            chassis = new THREE.Mesh(new THREE.BoxGeometry(4, 0.8, 8), diamondMat);
            chassis.position.y = 0.5;
            carGroup.add(chassis);

            cabin = new THREE.Mesh(new THREE.BoxGeometry(2.5, 1, 3.5), new THREE.MeshStandardMaterial({color:0x000000, transparent:true}));
            cabin.position.set(0, 1.2, 0.5);
            carGroup.add(cabin);

            spoiler = new THREE.Mesh(new THREE.BoxGeometry(4, 0.1, 1.5), diamondMat);
            spoiler.position.set(0, 1.5, -3); // Spoiler on the back
            carGroup.add(spoiler);

            const wGeo = new THREE.CylinderGeometry(0.7, 0.7, 0.5);
            const wMat = new THREE.MeshBasicMaterial({color: 0x222222});
            for(let i=0; i<4; i++) {
                const w = new THREE.Mesh(wGeo, wMat);
                w.rotation.z = Math.PI/2;
                w.position.set(i<2?2.2:-2.2, 0.5, i%2==0?2.5:-2.5);
                carGroup.add(w);
            }

            // Correct orientation: Flip the group so forward is +Z
            carGroup.rotation.y = Math.PI;
            scene.add(carGroup);
        }

        function checkCheat() {
            const val = document.getElementById('cheatInput').value.toLowerCase();
            if(val === 'race2win') {
                document.getElementById('stealthBtn').style.display = 'block';
                alert("STEALTH UNLOCKED");
            }
        }

        function toggleStealth() {
            isStealth = !isStealth;
            const op = isStealth ? 0.1 : 1.0;
            chassis.material.opacity = op;
            cabin.material.opacity = op;
            spoiler.material.opacity = op;
            document.getElementById('stealthBtn').innerText = isStealth ? "GHOST MODE: ON" : "GHOST MODE: OFF";
        }

        function addComment() {
            const input = document.getElementById('comInput');
            if(input.value) {
                const list = document.getElementById('commentList');
                list.innerHTML += `<div><b>Guest:</b> ${input.value}</div>`;
                input.value = "";
                list.scrollTop = list.scrollHeight;
            }
        }

        function playLink() {
            const url = document.getElementById('musicLink').value;
            const frame = document.getElementById('playerFrame');
            let id = url.includes("v=") ? url.split("v=")[1].split("&")[0] : url.split("youtu.be/")[1];
            if(id) {
                frame.style.display = "block";
                frame.src = `https://www.youtube.com/embed/${id}?autoplay=1`;
            }
        }

        function animate() {
            requestAnimationFrame(animate);
            const topKey = keyStack[keyStack.length - 1];
            
            if (topKey === 'KeyW') speed = Math.min(speed + 0.04, 1.5);
            else if (topKey === 'KeyS') speed = Math.max(speed - 0.04, -0.8);
            else speed *= 0.96;

            if (topKey === 'KeyA') playerYaw += 0.05;
            if (topKey === 'KeyD') playerYaw -= 0.05;

            carGroup.rotation.y = playerYaw;
            // Movement logic updated for forward orientation
            carGroup.position.x += Math.sin(playerYaw) * speed;
            carGroup.position.z += Math.cos(playerYaw) * speed;

            camera.position.set(carGroup.position.x - Math.sin(playerYaw)*15, 8, carGroup.position.z - Math.cos(playerYaw)*15);
            camera.lookAt(carGroup.position);

            renderer.render(scene, camera);
        }
    </script>
</body>
</html>
