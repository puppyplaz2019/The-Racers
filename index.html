<!DOCTYPE html>
<html>
<head>
    <title>Estate V54 - Optimized Lite</title>
    <style>
        body { margin: 0; overflow: hidden; background: #87CEEB; font-family: sans-serif; }
        #ui { position: absolute; top: 10px; left: 10px; color: white; background: rgba(0,0,0,0.7); padding: 12px; border-radius: 5px; pointer-events: none; font-size: 14px; }
        #overlay { position: absolute; width: 100%; height: 100%; background: #222; color: white; display: flex; flex-direction: column; align-items: center; justify-content: center; z-index: 100; }
        .btn { padding: 15px 30px; font-size: 20px; cursor: pointer; background: lime; border: none; font-weight: bold; }
        #msg { position: absolute; top: 50%; width: 100%; text-align: center; color: yellow; font-size: 20px; display: none; pointer-events: none; }
    </style>
</head>
<body>

    <div id="overlay">
        <h1>ESTATE V54 (LITE)</h1>
        <p>Optimized for performance</p>
        <button class="btn" onclick="start()">START GAME</button>
    </div>

    <div id="ui">
        <b>WASD</b>: Move | <b>Space</b>: Jump<br>
        <b>E</b>: Drive/Exit Car | <b>B</b>: Build Mode<br>
        <b>P</b>: Pause | <b>Shift</b>: Sprint<br>
        <hr>
        Time: <span id="time">Day</span> | Mode: <span id="mode">Walk</span>
    </div>

    <div id="msg"></div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script>
        let scene, camera, renderer, car, pet;
        let keys = {}, objects = [], buildMode = false, isPaused = false, isDriving = false;
        let vy = 0, isJumping = false, dayTime = 0.5;

        function start() {
            document.getElementById('overlay').style.display = 'none';
            init();
        }

        function init() {
            scene = new THREE.Scene();
            scene.background = new THREE.Color(0x87CEEB);

            camera = new THREE.PerspectiveCamera(75, window.innerWidth/window.innerHeight, 0.1, 1000);
            camera.position.set(0, 3, 10);

            renderer = new THREE.WebGLRenderer({ antialias: false }); // Antialias off for speed
            renderer.setSize(window.innerWidth, window.innerHeight);
            document.body.appendChild(renderer.domElement);

            // Lighting (Very simple ambient)
            scene.add(new THREE.AmbientLight(0xffffff, 1));

            // Biomes
            const floor = new THREE.PlaneGeometry(1000, 1000);
            const forestP = new THREE.Mesh(floor, new THREE.MeshBasicMaterial({color: 0x348C31}));
            forestP.rotation.x = -Math.PI/2; forestP.position.set(-500, 0, 0); scene.add(forestP);

            const desertP = new THREE.Mesh(floor, new THREE.MeshBasicMaterial({color: 0xEDC9AF}));
            desertP.rotation.x = -Math.PI/2; desertP.position.set(500, 0, 0); scene.add(desertP);

            // Features
            createVillage();
            createNature();
            createLake();
            createCar();
            createPet();

            // Input
            window.addEventListener('keydown', e => { 
                keys[e.code] = true; 
                if(e.code === 'KeyP') isPaused = !isPaused;
                if(e.code === 'KeyB') toggleBuild();
                if(e.code === 'KeyE') toggleDrive();
            });
            window.addEventListener('keyup', e => keys[e.code] = false);
            window.addEventListener('mousedown', placeBlock);

            loop();
        }

        function createVillage() {
            for(let i=0; i<2; i++) {
                const house = new THREE.Group();
                const body = new THREE.Mesh(new THREE.BoxGeometry(8, 6, 8), new THREE.MeshBasicMaterial({color:0xaaaaaa}));
                body.position.y = 3; house.add(body);
                const roof = new THREE.Mesh(new THREE.BoxGeometry(9, 1, 9), new THREE.MeshBasicMaterial({color:0x555555}));
                roof.position.y = 6.5; house.add(roof);
                // Furniture & Supplies (Interior props)
                const crate = new THREE.Mesh(new THREE.BoxGeometry(2,2,2), new THREE.MeshBasicMaterial({color:0x442200}));
                crate.position.set(2, 1, 2); house.add(crate);
                
                house.position.set(-20, 0, i * -20);
                scene.add(house);
                objects.push(new THREE.Box3().setFromObject(body));
            }
        }

        function createNature() {
            // Low-poly Trees
            for(let i=0; i<30; i++) {
                const tree = new THREE.Mesh(new THREE.BoxGeometry(2, 8, 2), new THREE.MeshBasicMaterial({color: 0x004400}));
                tree.position.set(-Math.random()*100 - 10, 4, (Math.random()-0.5)*100);
                scene.add(tree);
                objects.push(new THREE.Box3().setFromObject(tree));
            }
            // Low-poly Cacti
            for(let i=0; i<20; i++) {
                const cactus = new THREE.Mesh(new THREE.BoxGeometry(1, 5, 1), new THREE.MeshBasicMaterial({color: 0x00ff00}));
                cactus.position.set(Math.random()*100 + 10, 2.5, (Math.random()-0.5)*100);
                scene.add(cactus);
                objects.push(new THREE.Box3().setFromObject(cactus));
            }
        }

        function createLake() {
            const water = new THREE.Mesh(new THREE.CircleGeometry(15, 16), new THREE.MeshBasicMaterial({color: 0x0088ff}));
            water.rotation.x = -Math.PI/2; water.position.set(40, 0.1, 40);
            scene.add(water);
            // Fountain decoration
            const fountain = new THREE.Mesh(new THREE.CylinderGeometry(1, 1, 4), new THREE.MeshBasicMaterial({color: 0xffffff}));
            fountain.position.set(40, 2, 40);
            scene.add(fountain);
        }

        function createCar() {
            car = new THREE.Group();
            const body = new THREE.Mesh(new THREE.BoxGeometry(4, 2, 6), new THREE.MeshBasicMaterial({color: 0xff0000}));
            body.position.y = 1.5; car.add(body);
            car.position.set(10, 0, 10);
            scene.add(car);
        }

        function createPet() {
            pet = new THREE.Mesh(new THREE.SphereGeometry(0.5, 8, 8), new THREE.MeshBasicMaterial({color: 0xffff00}));
            scene.add(pet);
        }

        function toggleBuild() {
            buildMode = !buildMode;
            document.getElementById('mode').innerText = buildMode ? "Build" : "Walk";
        }

        function placeBlock() {
            if(!buildMode) return;
            const b = new THREE.Mesh(new THREE.BoxGeometry(2,2,2), new THREE.MeshBasicMaterial({color:0xffffff}));
            const dir = new THREE.Vector3(); camera.getWorldDirection(dir);
            b.position.copy(camera.position).add(dir.multiplyScalar(5));
            b.position.y = 1; scene.add(b);
            objects.push(new THREE.Box3().setFromObject(b));
        }

        function toggleDrive() {
            if(isDriving) {
                isDriving = false; camera.position.y = 3;
            } else if(camera.position.distanceTo(car.position) < 8) {
                isDriving = true;
            }
        }

        function loop() {
            requestAnimationFrame(loop);
            if(isPaused) return;

            // 1. Movement
            const sprint = keys['ShiftLeft'] ? 0.8 : 0.4;
            const speed = isDriving ? 1.6 : sprint; // Car is 2x faster than sprint
            
            if(keys['KeyA']) camera.rotation.y += 0.04;
            if(keys['KeyD']) camera.rotation.y -= 0.04;

            const dir = new THREE.Vector3();
            camera.getWorldDirection(dir);
            dir.y = 0; dir.normalize();

            let mx = 0, mz = 0;
            if(keys['KeyW']) { mx = dir.x * speed; mz = dir.z * speed; }
            if(keys['KeyS']) { mx = -dir.x * speed; mz = -dir.z * speed; }

            if(isDriving) {
                car.position.x += mx; car.position.z += mz;
                car.rotation.y = camera.rotation.y + Math.PI;
                camera.position.set(car.position.x, car.position.y + 4, car.position.z + 10);
                camera.lookAt(car.position);
            } else {
                camera.position.x += mx; camera.position.z += mz;
                // Simple Gravity/Jump
                if(keys['Space'] && !isJumping) { vy = 0.4; isJumping = true; }
                camera.position.y += vy;
                if(isJumping) vy -= 0.02;
                if(camera.position.y <= 3) { camera.position.y = 3; isJumping = false; vy = 0; }
            }

            // 2. Pet Follow
            pet.position.lerp(new THREE.Vector3(camera.position.x - 2, 2, camera.position.z - 2), 0.1);

            // 3. Time (Color change only for speed)
            dayTime += 0.001;
            if(dayTime > 1) dayTime = 0;
            if(dayTime > 0.8 || dayTime < 0.2) {
                scene.background.setHex(0x000022); // Night
                document.getElementById('time').innerText = "Night";
            } else {
                scene.background.setHex(0x87CEEB); // Day
                document.getElementById('time').innerText = "Day";
            }

            renderer.render(scene, camera);
        }
    </script>
</body>
</html>
